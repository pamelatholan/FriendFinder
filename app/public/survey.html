<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/3094232144.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Atomic+Age&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">

    <title>Survey</title>
</head>
<body>
        <div class="container2">
                <div class="row">
                  <div class="col-md-6" id="col3">
                        <a href="/" class="text-light">Home</a>
                  </div>
                  <div class="col-md-6" id="col4">
                        <a href="/api/friends" class="text-light">API Friends List</a>
                  </div>
                </div>
            
        <main>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                            <h1 id="header">Survey Questions</h1>
                            <div class="divider"></div>
    <br>
    <br>
    <br>
                            <div class="input-field col-md-6">
                                <h4>Your Name (Required)</h4>
                                <i class="fas fa-user-edit"></i>
                                <input type="text" id="formName" placeholder="Your Name Here" id="userName">
                            </div>
    <br>                        
                            <div class="input-field col-md-6">
                                <h4>Link to Photo Image (Required)</h4>
                                <i class="fas fa-photo-video"></i>
                                <input type="text" id="formImage" placeholder="Photo Link Here" id="userPhoto">
                            </div>
    <br>
    <br>
    <br>
                            <!-- Survey Questions -->
                            <div class="input-field col-md-12">
                                <h2>Question 1</h2>
                                <br>
                                <h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
                                <select id="question1" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 2</h2>
                                <br>
                                <h5>You have an active imagination.</h5>
                                <select id="question2" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 3</h2>
                                <br>
                                <h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
                                <select id="question3" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 4</h2>
                                <br>
                                <h5>Curiosity motivates you.</h5>
                                <select id="question4" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 5</h2>
                                <br>
                                <h5>People can rarely upset you.</h5>
                                <select id="question5" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 6</h2>
                                <br>
                                <h5>It is often difficult for you to relate to other people’s feelings.</h5>
                                <select id="question6" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 7</h2>
                                <br>
                                <h5>Truth should be more important than people’s sensitivities.</h5>
                                <select id="question7" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 8</h2>
                                <br>
                                <h5>You rarely get carried away by fantasies and ideas.</h5>
                                <select id="question8" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 9</h2>
                                <br>
                                <h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h5>
                                <select id="question9" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <div class="input-field col-md-12">
                                <h2>Question 10</h2>
                                <br>
                                <h5>You enjoy spending time with people more than by yourself.</h5>
                                <select id="question10" class="chosen-select">
                                    <option value="" disabled selected>Choose your option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                            <br>
                            <!-- Survey Submit Button -->
                            <div>
                                <button class="btn btn-light" type="submit" id="submitButton">Submit
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    
    
      <!-- Match Modal -->
      <div id="resultsModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
    
              <!-- Modal Content-->
              <div class="modal-content">

                <div class="modal-header">
                  <h2 class="modal-title"><strong>Meet Your New Friend!</strong></h2>
                </div>
    
                <!-- Modal Body (For Match Info) -->
                <div class="modal-body">
                  <h2 id="matchName"></h2>
                  <img class= "modal-content" id="matchImg" src="" alt="Image Not Found" style="max-width: 350px;">
                </div>
    
                <!-- Modal Footer (Close Button) -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
    
              </div>
    
            </div>
          </div>
    
    
        </div>
    
        <script>
          // Global Variable Declaration (scoping fix)
          var allFieldsCompleted;
          $(document).ready(function() {
            // Event Listener for Submission
            $('#submitButton').on('click', function() {
              
              // Check if all the user fields are completed
              checkIfComplete(function(){
                // Proceed with AJAX call if all questions are answered
                if(allFieldsCompleted){
                  collectInputs();
                }
                else{
                  alert('Please complete all fields before submitting!');
                }
              }); // end checkIfComplete() callback
            }); // end submit listener
          }); // document ready
          // Function to valid user input
          function checkIfComplete(callback){
            // Check through all the questions (i.e. iterate through all of class "chosen-select")
            var questionsCompleted;
            $('.chosen-select').each(function(){
              if ( $(this).val() == "" ){
                questionsCompleted = false;
              }
            })
            // This counters the async behavior of $.each()
            .promise().done(function(){
              // Check if any questions are incomplete
              if(questionsCompleted == false){
                allFieldsCompleted = false;
              }
              // Determine if Name is entered
              else if( $('#formName').val().trim() == "" ){
                allFieldsCompleted = false;
              }
              // Determine if Link is entered
              else if( $('#formImage').val().trim() == "" ){
                allFieldsCompleted = false;
              }
              // Otherwise, the all fields are completed
              else{
                allFieldsCompleted = true;
              }
              // Fire Off Callback (to counter async behavior of $.each)
              callback();       
            });
          }
          function collectInputs(){
            // Make new friend object
            var newFriend = {
              name: $('#formName').val().trim(),
              photo: $('#formImage').val().trim(),
              scores: []
            };
            // Loop through Questions to get scores
            var scoresArray = [];
            $('.chosen-select').each(function(){
              scoresArray.push( parseInt( $(this).val() ) ); // Parse Input Value as integer
            })
             // This counters the async behavior of $.each()
            .promise().done(function(){
              
              // Push the array of scores to the new friend object
              newFriend.scores = scoresArray;
              // POST the newFriend to the friends.js file and get back the best match
              var currentURL = window.location.origin;
              $.post(currentURL + "/api/friends", newFriend, function(data){
                // Add Best Match attributes to Modal
                $('#matchName').text(data.name);
                $('#matchImg').attr('src', data.photo);
                // Show the modal with the best match 
                $("#resultsModal").modal('toggle');
              }); // end AJAX POST
            });
          }
        </script>
    
      </body>
    
    </html>